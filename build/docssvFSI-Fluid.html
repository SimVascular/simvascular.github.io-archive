<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SimVascular Docs</title>

    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />

    <link href="css/shop-item.css" rel="stylesheet" type="text/css" />

    <link href="css/codestyle.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="font-awesome-4.1.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/1.5.2/css/ionicons.min.css">

    <link rel="shortcut icon" href="img/favicon.ico">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                <i class="fa fa-bars" id="barIcon"></i>
              </button>
                <a class="navbar-brand" id="brandName" href="index.html">
                  <img src="img/svlogo/svLogoSmallText.png" alt="...">
                </a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse navbar-right navbar-main-collapse">
                <ul class="nav navbar-nav">

                  <!-- USER GUIDES -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><span class="fa fa-user"></span> User Guides</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsQuickGuide.html"><b><span class="icon ion-ios7-bolt"></span> Getting Started</b></a></li>
                      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsModelGuide.html"><b><span class="icon ion-settings"></span> Modeling</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsMeshing.html"><b><span class="icon ion-ios7-keypad"></span> Meshing</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsFlowSolver.html"><b><span class="icon ion-play"></span> Simulation</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docssvFSI.html"><b><span class="icon ion-plus-round"></span> svFSI</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsSimCardio.html"><b><span class="icon ion-plus-round"></span> SimCardio</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsROMSimulation.html"><b><span class="icon ion-plus-round"></span> ROM Simulation</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsGenBC.html"><b><span class="icon ion-refresh"></span> GenBC</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsPythonInterface.html"><b><span class="icon ion-refresh"></span> Python Interface</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="docsReferences.html"><b><span class="icon ion-refresh"></span> References </b></a></li>
                    </ul>
                  </li>

                  <!-- CLINCAL CASES -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><i class="fa fa-stethoscope"></i> Clinical Cases</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase3.html"><b><span class="fa fa-user-md"></span> Coronary Normal</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase1.html"><b><span class="fa fa-user-md"></span> Aortofemoral Normal - 1</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase2.html"><b><span class="fa fa-user-md"></span> Aortofemoral Normal - 2</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="clinicalCase4.html"><b><span class="fa fa-user-md"></span> Healthy Pulmonary</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/projects/sv_tests"><b><span class="fa fa-user-md"></span> All demo projects</b></a></li>
                    </ul>
                  </li>

                  <!-- DEVELOPER GUIDES -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><span class="fa fa-caret-square-o-right"></span> Developer Guides</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://github.com/SimVascular/SimVascular/wiki/wiki_for_developers"><b><span class="fa fa-file-text-o"></span> Compile Source Code</b></a></li>
                    </ul>
                  </li>

                  <!-- svCOMMUNITY -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b><i class="fa fa-users"></i> svCommunity</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/forums/viewforum.php?f=188"><b><span class="fa fa-users"></span> Public Forum</b></a></li>
                      <li role="presentation" class="divider"></li>
		      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://github.com/SimVascular/SimVascular/wiki/"><b><span class="fa fa-file-text-o"></span> Wiki</b></a></li>
		      <li role="presentation" class="divider"></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/mailman/listinfo/simvascular-news"><b><span class="fa fa-sign-in"></span> Join News Mailing List</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://simtk.org/pipermail/simvascular-news/"><b><span class="fa fa-pencil-square-o"></span> News Mailing List Archive</b></a></li>
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="https://github.com/SimVascular/SimVascular/issues"><b><span class="fa fa-bug"></span> Report bugs and request features</b></a></li>
                    </ul>
                  </li>

                  <!-- REFERENCES -->
                  <li>
                    <a href="docsRefs.html" id="dropdownMenu1" >
                      <b><span class="icon ion-document-text"></span>References</b>
                    </a>
                  </li>

                  <!-- Archives -->
                  <li>
                    <a href="#" id="dropdownMenu1" data-toggle="dropdown">
                      <b> Archives</b>
                    </a>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                      <li role="presentation"><a role="menuitem" tabindex="-1" href="archiveQuickGuideSV2.html"><b>SimVascular 2.0</b></a></li>
                    </ul>
                  </li>

                    <!-- <li><a href="docsQuickGuide.html" id="btnQuickGuide"><b><span class="icon ion-ios7-bolt"></span> Quick Guide</b></a></li>
                    <li><a href="docsModelGuide.html" id="btnModelGuide"><b><span class="icon ion-settings"></span> Modeling</b></a></li>

                    <li><a href="docsMeshing.html" id="btnMeshing"><b><span class="icon ion-ios7-keypad"></span> Meshing</b></a></li>
                    <li><a href="docsPresolver.html" id="btnPresolver"><b><span class="icon ion-log-in"></span> svPre</b></a></li>
                    <li><a href="docsFlowSolver.html" id="btnFlowSolver"><b><span class="icon ion-play"></span> svSolver</b></a></li>
                    <li><a href="docsRefs.html" id="btnRefs"><b><span class="icon ion-document-text"></span> References</b></a></li>
                    <li><a href="clinicalCase1.html" id="btnRefs"><b>Case Studies</b></a></li> -->
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <!--Nav Bar -->
<div class="row">
    <div class="col-xs-1 col-sm-1 hidden-md hidden-lg">
    </div>
    <!-- ONE COLUMN OF SPACE -->
    <nav class="hidden-xs hidden-sm col-md-2 col-lg-2 bs-docs-sidebar">






        <ul id="sidebar" class="nav nav-stacked fixed mansvFSI-Fluid"> <!--Nav Bar -->
<p><h4>Hemodynamics <br> Modeling <br> using svFSI</h4></p>
<li><a href="#intro">Introduction</a></li>

<li><a href="#nn">Non-Newtonian flow</a>
  <ul class="nav nav-stacked">
    <li><a href="#nn_theory">Viscosity models</a></li>
    <li><a href="#nn_input">Input file</a></li>
  </ul>
</li>

<li><a href="#pres">Prescribed wall motion</a>
  <ul class="nav nav-stacked">
    <li><a href="#pres_wall">Wall motion</a></li>
    <li><a href="#pres_input">Input file</a></li>
  </ul>
</li>

<li><a href="#ref">Reference</a></li>
</ul>
      








    </nav>

    <!--Main Content -->
    <div class="col-xs-10 col-sm-10 col-md-9 col-lg-9" id="manualContent">

      <!-- ACTUAL CONTENT -->






        <div class="mansvFSI-Fluid"><section id="intro" class="group"><h2>Hemodynamics Modeling using <strong>svFSI</strong></h2>

<p>Modeling of cardiovascular flow is the main function of <strong>SimVascular</strong>. Currently, the default flow solver of <strong>SimVasculr</strong> is <a href="https://simvascular.github.io/archiveFlowSolverSV2.html"><strong>svSolver</strong></a>. All of the features in <strong>svSolver</strong> exists in <strong>svFSI</strong> including RCR boundary condition, Coupled Momentum Method, GenBC etc. Also, we have carefully tested the new solver to make sure it produce the same results as <strong>svSolver</strong>. In this section, we won&rsquo;t dwell on the similarities between these two solvers, and instead will focus two new features in flow simulation using <strong>svFSI</strong>, i.e., non-Newtonian flow model and simulation of prescribed motion.</p>
</section>

<section id="nn" class="group"><h2>Non-Newtonian flow</h2>

<p>Blood is a complex mixture that consists of plasma, blood cells and platelets. The blood viscosity is a complicated subject. It is strongly dependent on several factors such as temperature, hematocrit and, especially, the shear rate. From experimental studies, it is determined that the blood behaves like Newtonian flow at high shear rate ($&gt;100 s^{-1}$). In most large arteries such as aorta, coronary arteries, the shear rate is well above this number and blood can be treated as a Newtonian fluid, that is the viscosity is a constant. On the other hand, when the shear rate is below this threshold, blood presents strong shear thinning behavior, i.e. the viscosity decreases with increasing shear rate. Many viscosity models have been proposed to represent this non-Newtonian behavior <a href="#ref-1">[1]</a>.</p>
</section>
<section id="nn_theory" class="subgroup"><h3>Viscosity models</h3>

<p>Currently, <strong>svFSI</strong> supports three viscosity models: Newtonian, Carreau-Yasuda and Casson <a href="#ref-2">[2]</a>.</p>

<figure>
  <img class="svImg svImgSm" src="documentation/svfsi/fluid/imgs/non-newtonian.png" style="width:100%;height:auto;max-width: 30vw;">
  <figcaption class="svCaption" >Non-Newtonian viscosity model<a href="#ref-1">[1]</a>.</figcaption>
</figure>

<p>Carreau-Yassuda model is defined as</p>

<p>$$\eta=\eta_\infty + (\eta_0 - \eta_\infty) \left[ 1 + \left( \lambda\dot(\gamma)^a \right) \right]^{\frac{n-1}{a}}$$</p>

<p>Here:
<ul>
    <li>$\eta_\infty$: limiting high shear-rateviscosity;</li>
    <li>$\eta_0$: limiting low shear-rate viscosity;</li>
    <li>$\lambda$: shear-rate tensor multiplier;</li>
    <li>$\dot{\gamma}$: shear rate;</li>
    <li>$a$: shear-rate tensor exponent;</li>
    <li>$n$: power-law index.</li>
</ul> </p>

<p>Casson model is defined as</p>

<p>$$\eta=\frac{1}{\dot{\gamma}}\left[ k_0 ( c ) + k_1 ( c )\sqrt{\dot{\gamma}} \right]^2$$</p>

<p>Here, $k_0 ( c )$ and $k_1 ( c )$ are functions of the hematocrit $c$. </p>
</section>
<section id="nn_input" class="subgroup"><h3>Input file</h3>

<p>The input file mostly follows the master input file <a href="./svFSI_master.inp"><code>svFSI_master.inp</code></a>. Some specific input options are discussed below:</p>

<p>For Newtonian fluid:</p>
<pre class="highlight plaintext"><code>   Viscosity: Constant {
      Vsalue: 0.04
   }
</code></pre>

<p>For Casson fluid</p>
<pre class="highlight plaintext"><code>   Viscosity: Cassons {
      Asymptotic viscosity parameter: 0.3953
      Yield stress parameter: 0.22803
      Low shear-rate threshold: 0.5
   }
</code></pre>

<p>For Carreau-Yasuda fluid</p>
<pre class="highlight plaintext"><code>   Viscosity: Carreau-Yasuda {
      Limiting high shear-rate viscosity: 0.022
      Limiting low shear-rate viscosity: 0.22
      Shear-rate tensor multiplier (lamda): 0.11
      Shear-rate tensor exponent (a): 0.644
      Power-law index (n): 0.392
   }
</code></pre>
</section>

<section id="pres" class="group"><h2>Simulations with prescribed wall motion</h2>

<p>In this section, we discuss how to set up a simulation with prescribed wall motion. For example, one may wish to extract the motion of the walls of the ventricle from CT/MR scans, and reconstruct the flow fields by solving the Navier-Stokes equations. This is accomplished by computing the displacement trajectory of the endocardial surface and prescribed it as the boundary condition. This must be done offline by the user for their specific problem. This is typically done for a small subset of the total times, and displacements between the specified times are prescribed by using a piece-wise linear interpolant. Some researchers refer to this method as the one-way coupled fluid-structure interaction modeling. But since only fluid equation is solved here, we categorize it as flow simulation. </p>
</section>
<section id="pres_wall" class="subgroup"><h3>Wall motion</h3>

<p>There are many established pipelines to obtain the wall motion from CT/MR scans<a href="#ref-3">[3-5]</a>. Here, we would recommend using the <a href="http://simvascular.github.io/docsSimCardio.html#automatic-cardiac-modeling">cardiac geometric modeling tool</a> developed in the <strong>SimCardio</strong> project.</p>

<p>For the wall motion file, the file format is as follows. First, specify the dimension of the problem (three), the number of times at which to specify the displacements, and the number of vertices in the moving wall mesh. Then specify the times at which the displacements occur. Next, for each vertex, specify its index and then the prescribed displacements for each time. Note that in the case of multiple moving faces, these numbers may not start at one for any given face, as indexing is global. If a vertex is on an edge between two faces, it should have the same index and displacement fields, specified redundantly in both files.</p>
<pre class="highlight plaintext"><code>Dimension n_times m_vertices
t_1
t_2
...
t_n
vertex_1_index
displacement_1_vertex_1
displacement_2_vertex_1
...
displacement_n_vertex_1
vertex_2_index 
displacement_1_vertex_2
displacement_2_vertex_2
...
displacement_n_vertex_2
... 
</code></pre>

<p>For example,</p>
<pre class="highlight plaintext"><code>3   21   14907
0.000000
3.800E-2
7.600E-2
1.140E-1
1.520E-1
1.900E-1
2.280E-1
2.660E-1
3.040E-1
3.419E-1
3.800E-1
4.180E-1
4.560E-1
4.940E-1
5.320E-1
5.699E-1
6.080E-1
6.460E-1
6.839E-1
7.220E-1
7.600E-1
1
0.000000   0.000000   0.000000   
2.800E-1   -8.99E-2   -1.00E-2   
8.799E-1   -2.09E-1   -8.10E-1   
1.339999   -1.59E-1   -1.43000   
1.509999   7.000E-2   -1.59000   
1.310000   3.100E-1   -1.52000   
1.069999   5.100E-1   -1.41000   
1.009999   6.000E-1   -1.28000   
9.699E-1   3.600E-1   -1.10000   
1.049999   -1.09E-1   -8.80E-1   
1.169999   -6.69E-1   -7.60E-1   
1.169999   -1.17999   -7.90E-1   
1.129999   -1.31999   -9.69E-1   
1.049999   -1.25999   -1.34000   
1.000000   -9.39E-1   -1.64000   
9.899E-1   -4.29E-1   -1.96000   
1.000000   3.000E-2   -2.15000   
9.299E-1   3.600E-1   -1.90000   
6.599E-1   4.200E-1   -1.14000   
1.999E-1   1.500E-1   -3.50E-1   
0.000000   0.000000   0.000000   
2
0.000000   0.000000   0.000000   
2.700E-1   -8.99E-2   0.000000   
8.500E-1   -1.99E-1   -6.80E-1   
1.280000   -1.59E-1   -1.16999   
1.430000   5.000E-2   -1.28000   
1.230000   2.599E-1   -1.19999   
1.010000   4.499E-1   -1.09000   
9.500E-1   5.099E-1   -9.69E-1   
9.100E-1   2.400E-1   -8.19E-1   
1.000000   -2.59E-1   -6.70E-1   
1.120000   -8.29E-1   -5.69E-1   
1.130000   -1.31999   -5.89E-1   
1.090000   -1.44999   -7.50E-1   
1.000000   -1.36000   -1.06999   
9.400E-1   -1.00999   -1.31000   
9.300E-1   -4.69E-1   -1.56999   
9.500E-1   0.000000   -1.72999   
8.900E-1   3.299E-1   -1.53999   
6.200E-1   3.999E-1   -9.39E-1   
1.900E-1   1.399E-1   -2.90E-1   
0.000000   0.000000   0.000000  
... 
</code></pre>

<p>Note that in this example, we wish the mesh motion to be periodic in time, and thus the final displacement is zero.</p>
</section>
<section id="pres_input" class="subgroup"><h3>Input file</h3>

<p>To set up the input file, set the equation to be FSI to allow the mesh to move under the ALE framework, even though there is not necessarily a structure. For the moving wall, add the motion file when specifying the wall boundary condition, and turn on the option “Impose on state variable integral”.</p>
<pre class="highlight plaintext"><code>    Add BC: moving_wall {
        Type: Dirichlet 
        Time dependence: General
        Temporal and spatial values file path: wall_motion.dat
        Profile: Flat
        Zero out perimeter: 1
        Impose flux: 0
        #---------------- Add this line to the moving boundary face -----------
        Impose on state variable integral: 1
    }
</code></pre>

<p>It is recommended to include remeshing if the wall motion is such that the domain undergoes large changes. For example, set</p>
<pre class="highlight plaintext"><code>    Remesher: Tetgen {
        Max edge size: lumen { val: 3.0 }
        Min dihedral angle: 10.0
        Max radius ratio: 1.1
        Remesh frequency: 100
        Frequency for copying data: 1  
    }
</code></pre>

<p>The max edge size should be consistent with the original mesh size.</p>

<p>Under the mesh equation, we similarly add the motion file.</p>
<pre class="highlight plaintext"><code>    Add equation: mesh {
        Coupled: 1
        Min iterations: 1
        Max iterations: 8
        Tolerance: 1e-3
        Residual dB reduction: -20
        Poisson ratio: 0
        Output: Spatial {
            Displacement: t
        }

        #---------- Add the BC for the moving_wall to the mesh equation as well ------
        Add BC: moving_wall {
            Type: Dirichlet 
            Time dependence: General
            Temporal and spatial values file path: wall_motion.dat
            Profile: Flat
            Zero out perimeter: 1
            Impose flux: 0
            #---------------- Add this line to the moving boundary face -----------
            Impose on state variable integral: 1
    }
</code></pre>

<p>Follow this <a href="http://simvascular.github.io/docssvFSI.html#app_restart_after_remesh">instruction</a> if you need to restart your simulation after stoppage.</p>
</section>

<section id="ref" class="group"><h2>Reference</h2>

<p><a id="ref-1">
[1] Chandran KB, Rittgers SE, Yoganathan AP. <strong>Biofluid mechanics: the human circulation.</strong> CRC press; 2006 Nov 15.  </a></a></p>

<p><a id="ref-2"> <a href="https://doi.org/10.1063/1.2772250">
[2] Boyd, Joshua, James M. Buick, and Simon Green. <strong>Analysis of the Casson and Carreau-Yasuda Non-Newtonian Blood Models in Steady and Oscillatory Flows Using the Lattice Boltzmann Method</strong>. Physics of Fluids 19, no. 9 (September 2007): 093103.  </a></a></p>

<p><a id="ref-3"> 
[3] Vedula V, Lee J, Xu H, Kuo CC, Hsiai TK, Marsden AL.<strong> A method to quantify mechanobiologic forces during zebrafish cardiac development using 4-D light sheet imaging and computational modeling.</strong> PLoS computational biology. 2017 Oct 30;13(10):e1005828.</a></a></p>

<p><a id="ref-4"> 
[4] Mittal R, Seo JH, Vedula V, Choi YJ, Liu H, Huang HH, Jain S, Younes L, Abraham T, George RT. <strong>Computational modeling of cardiac hemodynamics: current status and future outlook.</strong> Journal of Computational Physics. 2016 Jan 15;305:1065-82.  </a></a></p>

<p><a id="ref-5"> <a href="https://doi.org/10.1115/1.4048032">
[5] Kong, F., and Shadden, S. C. (2020). **Automating Model Generation for Image-based Cardiac Flow Simulation**. ASME. J Biomech Eng. </a> </p>

<p><br><br><br><br><br></p>
</section>
</div>









    </div>
</div>


    <!-- /.container -->
    <nav class="navbar navbar-default navbar-fixed-bottom">
        <div class="container-fluid text-center">
          <ul class="nav navbar-nav">
            <li><a>Copyright &copy; SimVascular Development Team - 2017</a></li>
          </ul>
        </div>
        <!-- /.container -->
    </nav>


    <script src="js/jquery-1.11.0.js" type="text/javascript"></script><script src="js/bootstrap.min.js" type="text/javascript"></script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
      });
      $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 40
      });
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-55333921-1', 'auto');
      ga('send', 'pageview');
    </script>

    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

</body>

</html>
